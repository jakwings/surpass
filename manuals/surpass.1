.\" Copyright (C) 2021 Jak.W https://github.com/jakwings/surpass
.\"
.\"   TERMS AND CONDITIONS FOR COPYING, DISTRIBUTION AND MODIFICATION
.\"
.\"  0. You just DO WHAT THE FUCK YOU WANT TO.
.Dd December 18, 2021
.Os
.Dt SURPASS 1
.Sh NAME
.Nm surpass
.Nd a simple password manager
.Sh SYNOPSIS
.Nm
.Bk -words
.Op Ao command Ac Oo Ao argument Ac Oc Ns ... Oo Ao option Ac Oc Ns ...
.Ek
.Sh DESCRIPTION
.Nm
is a password manager that keeps the passwords encrypted with a public
key generated by
.Xr openssl 1 .
On the other hand, decryption requires a paired secret key which is
protected by a passphrase from the user.
This utility provides a series of commands for manipulating the password
store which is a simple directory tree residing at
.Pa ~/.config/surpass .
.Pp
.Nm
is design for a single-user environment where no other users on the same
host can eavesdrop on the running processes.
Please take great care about this.
.Pp
.Sq Ic surpass tree
is executed if no
.Ao command Ac
is specified.
.Sh COMMANDS
.de describe-option-force
Use option
.Sq force
to disable user interaction.
..
.de describe-option-copy
Use option
.Sq copy
to copy the password to the clipboard.
..
.de describe-option-push
With an existing passfile and option
.Sq push
specified, the new password will be prepended to the original passfile
instead of rewriting the whole passfile.
..
.Bl -tag -width 4n
.It Ic help Oo Ao command Ac Oc
Show usage of a
.Ao command Ac ,
or show the full manual if no
.Ao command Ac
is specified.
.It Ic init Oo key= | force Oc Ns ...
Initialize the password store.
A new key pair named
.Qq surpass
(or the value from option
.Sq key )
will be generated for future use.
.describe-option-force
.It Ic new Ao passname Ac Oo
key= | size= | charset= | grep= | push | copy | force
.Oc Ns ...
Generate a random password and save it in a passfile named
.Ao passname Ac
in the store.
The password will be encrypted by the default key pair
.Qq surpass
if the key pair to use is not specified by option
.Sq key .
A custom password length can specified with option
.Sq size .
Use option
.Sq charset
to limit the possible characters with a pattern recognizable by
.Xr tr 1 .
Then option
.Sq grep
can be used to enforce a
.Xr grep 1
pattern on the new password.
.describe-option-push
.describe-option-copy
.describe-option-force
.It Ic show Ao passname Ac Oo line= | grep= | copy | force Oc Ns ...
Descrypt the passfile named
.Ao passname Ac
from the password store and show the first line of the contents.
You can specify a line number in option
.Sq line
to show another line.
You can also filter the whole contents with a
.Xr grep 1
pattern specified in option
.Sq grep .
Option
.Sq grep
overrides option
.Sq line .
.describe-option-copy
.describe-option-force
.It Ic edit Ao passname Ac Oo
key= | push | show | copy | force
.Oc Ns ...
Save contents from standard input to the passfile named
.Ao passname Ac
in the password store.
Encrypt the new contents using the default key pair named
.Qq surpass
unless specified in option
.Sq key .
The new password is not echoed back unless option
.Sq show
is specified.
.describe-option-push
.describe-option-copy
.describe-option-force
.It Ic find Ao pattern Ac Oo tree Oc Ns ...
Search the password store and show a list of passfiles the names of
which all match the
.Xr grep 1
.Ao pattern Ac .
Use option
.Sq tree
to show a tree-view of passfiles.
.Pp
Command aliases: search
.It Ic tree Oo Ao passname Ac Oc
Show a tree-view of the passfile or folder named
.Ao passname Ac
in the password store.
.It Ic list Oo Ao passname Ac Oc
Show a list of passfiles in the folder named
.Ao passname Ac
or the passfile named
.Ao passname Ac
in the password store.
.Pp
Command aliases: ls
.It Ic copy Ao passname Ac Ao newname Ac Oo force Oc Ns ...
Copy the passfile named
.Ao passname Ac
to passfile named
.Ao newname Ac
in the password store.
.describe-option-force
.Pp
Command aliases: cp
.It Ic move Ao passname Ac Ao newname Ac Oo force Oc Ns ...
Move the passfile named
.Ao passname Ac
to passfile named
.Ao newname Ac
in the password store.
.describe-option-force
.Pp
Command aliases: mv rename
.It Ic remove Ao passname Ac Ao newname Ac Oo all | force Oc Ns ...
Remove the passfile named
.Ao passname Ac
or remove all passfiles in the folder named
.Ao passname Ac
from the password store.
To remove a non-empty folder option
.Sq all
must be specified.
.describe-option-force
.Pp
Command aliases: rm delete del
.It Ic own Ao passfile Ac Oo key= | force Oc Ns ...
Claim ownership of the passfile or folder named
.Ao passname Ac
in the password store.
Re-encrypt the passfiles using the default key pair named
.Qq surpass
or using the one specified in option
.Sq key .
.describe-option-force
.It Ic keys
List all available key pairs for encryption and decryption.
.It Ao command Ac Oo Ao arguments Ac Oc
If an executable file named
.Qq surpass- Ns Ao command Ac
can be found, execute it with the command line
.Ao arguments Ac
after assigning the filepath of the
.Nm
program to the environment variable
.Ev SURPASS .
.El
.Pp
Options take the form of
.Ao name Ac Ns = Ns Ao value Ac
or just
.Ao name Ac .
An option
.Ao name Ac
alone may not equal
.Ao name Ac Ns = Ns Qq ""
(empty string).
But some options like
.Sq push ,
.Sq copy ,
.Sq all
and
.Sq force
always take effect once they are specified on the command line.
.Sh ENVIRONMENT
You can override the following variables before using
.Nm .
.Bl -tag -width 6n
.It Ev SURPASS_HOME
The location of the password store.
.It Ev SURPASS_PASSWORD_LENGTH
The default length of new passwords.
.It Ev SURPASS_PASSWORD_CHARSET
The default
.Xr tr 1
charset for generating passwords.
.It Ev SURPASS_PASSWORD_GREP
The default
.Xr grep 1
pattern to enforce on new passwords.
.It Ev SURPASS_CLIPBOARD_COPY
A custom command for copying passwords to the clipboard.
.It Ev SURPASS_CLIPBOARD_PASTE
A custom command for pasting passwords from the clipboard.
.It Ev SURPASS_CLIPBOARD_TIMEOUT
Seconds to wait before removing passwords from the clipboard.
.It Ev SURPASS_CMD_GREP
The
.Xr grep 1
command for filtering text content.
.El
.Sh HISTORY
.Nm
is a simple password manager inspired by
.Sy pass ,
.Sy opm
and
.Sy jpm .
Unlike its forefather
.Sy pass ,
.Nm
is implemented in a
.Tn POSIX
shell instead of
.Xr bash ,
and strives for minimum dependencies on external commands.
Its core dependency
.Xr openssl
can be easily replaced by other asymmetric key pair generation programs
without too much hassle.
.Pp
.Bl -item -compact
.It
.Sy pass
https://www.passwordstore.org/
.It
.Sy \ opm
https:\://github.com\:/rnagy\:/opm
.It
.Sy \ jpm
https:\://github.com\:/jeremyevans\:/jpm
.El
.Sh COPYRIGHT
Copyright (C) 2021 Jak.W https:\://github.com\:/jakwings\:/surpass
.Pp
\ \ TERMS AND CONDITIONS FOR COPYING, DISTRIBUTION AND MODIFICATION
.Pp
\ 0. You just DO WHAT THE FUCK YOU WANT TO.
.Sh BUGS
Please report bugs to https:\://github.com\:/jakwings\:/surpass\:/issues
.Sh SEE ALSO
.Xr openssl 1 ,
.Xr openssl-smime 1 ,
.Xr openssl-enc 1 ,
.Xr tr 1 ,
.Xr grep 1
